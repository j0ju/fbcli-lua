# check if python version is set in current dir
_PYTHON=python3

if [ -r requirements.txt ]; then
  if [ ! -d ".venv" ] ; then
    echo "Creating virtualenv in $PWD/.venv with $($_PYTHON -V)"
    virtualenv .venv -p $_PYTHON
    .venv/bin/pip install --upgrade pip
    .venv/bin/pip install -r requirements.txt
    echo "Created virtualenv in $PWD/.venv with $($_PYTHON -V)"
  fi

  if [ -r .venv/bin/activate ]; then
    . .venv/bin/activate
    echo "Activated $(python3 -V) virtualenv in $PWD/.venv"
  fi
fi

#if [ -r requirements.yml ]; then
#  ansible-galaxy collection install -r requirements.yml
#fi

# - add $DIR/sbin for each $DIR/bin in PATH
  _PATH="$PATH"
  PATH=
  while [ -n "$_PATH" ]; do
    p="${_PATH%%:*}"
    _PATH="${_PATH#$p}"
    _PATH="${_PATH#:}"
    [ -d "$p" ] || continue
    case "$PATH" in
      $p | $p:* | *:$p | *:$p:* ) ;;
      "" ) PATH="$p" ;;
      * ) PATH="$PATH:$p" ;;
    esac
  done
  unset p _PATH
  export PATH

# disable warnings about direnv not able to set PS1
# see: https://github.com/direnv/direnv/wiki/PS1
unset PS1
